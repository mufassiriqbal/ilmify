<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ilmify - Offline Knowledge Server for Rural Schools">
    <title>Ilmify - Education That Reaches You</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/auth.css">
</head>
<body>
    <header class="header">
        <div class="container header-content">
            <div class="logo">
                <span class="logo-icon">ğŸ“š</span>
                <div>
                    <h1>Ilmify</h1>
                    <p class="tagline">Education That Reaches You</p>
                </div>
            </div>
            <nav class="header-nav" id="headerNav">
                <!-- Will be populated by JS based on user role -->
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <!-- Welcome Banner -->
            <section class="welcome-banner" id="welcomeBanner">
                <div class="welcome-content">
                    <h2>Welcome to Ilmify! ğŸ‘‹</h2>
                    <p>Your offline knowledge hub for quality education</p>
                </div>
            </section>

            <!-- Search Section -->
            <section class="search-section">
                <div class="search-box">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="Search resources... / ØªÙ„Ø§Ø´ Ú©Ø±ÛŒÚº..."
                        aria-label="Search resources"
                    >
                    <button id="searchBtn" class="search-btn" aria-label="Search">
                        ğŸ”
                    </button>
                </div>
            </section>

            <!-- Categories Section -->
            <section class="categories-section">
                <h2 class="section-title">Browse by Category</h2>
                <div class="categories-grid">
                    <button class="category-card" data-category="textbooks">
                        <div class="category-icon">ğŸ“–</div>
                        <h3>School Textbooks</h3>
                        <p>Ù†ØµØ§Ø¨ÛŒ Ú©ØªØ§Ø¨ÛŒÚº</p>
                        <span class="resource-count" id="textbooks-count">0 resources</span>
                    </button>

                    <button class="category-card" data-category="videos">
                        <div class="category-icon">ğŸ¬</div>
                        <h3>Video Lectures</h3>
                        <p>ÙˆÛŒÚˆÛŒÙˆ Ù„ÛŒÚ©Ú†Ø±Ø²</p>
                        <span class="resource-count" id="videos-count">0 resources</span>
                    </button>

                    <button class="category-card" data-category="health-guides">
                        <div class="category-icon">ğŸ¥</div>
                        <h3>Health Guides</h3>
                        <p>ØµØ­Øª Ú©Û’ Ø±ÛÙ†Ù…Ø§</p>
                        <span class="resource-count" id="health-guides-count">0 resources</span>
                    </button>

                    <button class="category-card" data-category="courses" onclick="document.getElementById('coursesSection').scrollIntoView({behavior: 'smooth'})">
                        <div class="category-icon">ğŸ“</div>
                        <h3>Courses</h3>
                        <p>Ú©ÙˆØ±Ø³Ø²</p>
                        <span class="resource-count" id="courses-count">Interactive learning</span>
                    </button>

                    <button class="category-card" data-category="quiz" onclick="document.getElementById('quizSection').scrollIntoView({behavior: 'smooth'})">
                        <div class="category-icon">ğŸ¯</div>
                        <h3>Practice Quiz</h3>
                        <p>Ø³ÙˆØ§Ù„Ø§Øª Ú©ÛŒ Ù…Ø´Ù‚</p>
                        <span class="resource-count">Test your knowledge</span>
                    </button>
                </div>
            </section>

            <!-- Quiz Section -->
            <section class="quiz-section" id="quizSection">
                <!-- Quiz content will be dynamically loaded by quiz.js -->
            </section>

            <!-- Courses Section -->
            <section class="courses-section" id="coursesSection">
                <div id="coursesContainer">
                    <!-- Courses will be dynamically loaded here -->
                </div>
            </section>

            <!-- Resources Section -->
            <section class="resources-section" id="resourcesSection">
                <div class="resources-header">
                    <h2 class="section-title" id="resourcesTitle">All Resources</h2>
                    <button class="back-btn" id="backBtn" style="display: none;">
                        â† Back to Categories
                    </button>
                </div>
                <div class="resources-grid" id="resourcesGrid">
                    <!-- Resources will be dynamically loaded here -->
                </div>
                <div class="no-results" id="noResults" style="display: none;">
                    <span class="no-results-icon">ğŸ”</span>
                    <p>No resources found. Try a different search term.</p>
                    <p>Ú©ÙˆØ¦ÛŒ Ù†ØªØ§Ø¦Ø¬ Ù†ÛÛŒÚº Ù…Ù„Û’Û” Ø¯ÙˆØ³Ø±Û’ Ø§Ù„ÙØ§Ø¸ Ø³Û’ ØªÙ„Ø§Ø´ Ú©Ø±ÛŒÚºÛ”</p>
                </div>
            </section>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>Ilmify - Education That Reaches You</p>
            <p class="footer-urdu">ØªØ¹Ù„ÛŒÙ… Ø¬Ùˆ Ø¢Ù¾ ØªÚ© Ù¾ÛÙ†Ú†Û’</p>
        </div>
    </footer>

    <!-- Upload Modal -->
    <div class="modal" id="uploadModal" style="display: none;">
        <div class="modal-content upload-modal">
            <div class="modal-header">
                <h3>ğŸ“¤ Upload Resource</h3>
                <button class="modal-close" onclick="closeUploadModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="uploadForm" onsubmit="handleUpload(event)">
                    <div class="form-group">
                        <label for="resourceTitle">Title / Ø¹Ù†ÙˆØ§Ù†</label>
                        <input type="text" id="resourceTitle" name="title" required placeholder="Enter resource title">
                    </div>
                    
                    <div class="form-group">
                        <label for="resourceCategory">Category / Ø²Ù…Ø±Û</label>
                        <select id="resourceCategory" name="category" required>
                            <option value="">Select category</option>
                            <option value="textbooks">ğŸ“– Textbooks</option>
                            <option value="videos">ğŸ¬ Videos</option>
                            <option value="health-guides">ğŸ¥ Health Guides</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>File / ÙØ§Ø¦Ù„</label>
                        <div class="file-upload-area" id="fileUploadArea">
                            <input type="file" id="resourceFile" name="file" accept=".pdf,.mp4,.webm,.mkv" hidden>
                            <div id="fileUploadContent">
                                <span class="upload-icon">ğŸ“</span>
                                <p>Click or drag file here</p>
                                <p class="upload-hint">PDF, MP4, WebM, MKV (Max 500MB)</p>
                            </div>
                            <div id="fileSelected" style="display: none;">
                                <span class="file-icon">ğŸ“„</span>
                                <span class="file-name" id="selectedFileName"></span>
                                <span class="file-size" id="selectedFileSize"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="upload-progress" id="uploadProgress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <span class="progress-text" id="progressText">Uploading...</span>
                    </div>
                    
                    <div class="form-error" id="uploadError" style="display: none;">
                        <span>âš ï¸</span>
                        <p id="uploadErrorText"></p>
                    </div>
                    
                    <div class="form-success" id="uploadSuccess" style="display: none;">
                        <span>âœ…</span>
                        <p>Resource uploaded successfully!</p>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-block">
                        ğŸ“¤ Upload Resource
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteModal" style="display: none;">
        <div class="modal-content delete-modal">
            <div class="modal-header">
                <h3>ğŸ—‘ï¸ Delete Resource</h3>
                <button class="modal-close" onclick="closeDeleteModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete:</p>
                <p class="delete-resource-name" id="deleteResourceName"></p>
                <p class="delete-warning">âš ï¸ This action cannot be undone.</p>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
                    <button class="btn btn-danger" onclick="confirmDelete()">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Management Modal (Admin Only) -->
    <div class="modal" id="userModal" style="display: none;">
        <div class="modal-content user-modal">
            <div class="modal-header">
                <h3>ğŸ‘¥ User Management</h3>
                <button class="modal-close" onclick="closeUserModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="user-type-tabs">
                    <button class="user-type-tab active" onclick="switchUserTab('student')">ğŸ‘¨â€ğŸ“ Students</button>
                    <button class="user-type-tab" onclick="switchUserTab('faculty')">ğŸ‘¨â€ğŸ« Faculty</button>
                </div>
                
                <div class="add-user-section">
                    <h4 id="addUserTitle">â• Add New Student</h4>
                    <form id="addUserForm" onsubmit="handleAddUser(event)">
                        <div class="form-row">
                            <input type="text" id="newUserFirstName" placeholder="First Name" required>
                            <input type="text" id="newUserLastName" placeholder="Last Name" required>
                        </div>
                        <input type="email" id="newUserEmail" placeholder="Email" required>
                        <input type="password" id="newUserPassword" placeholder="Password (min 6 chars)" minlength="6" required>
                        <div id="studentFieldsAdd">
                            <input type="text" id="newUserGrade" placeholder="Grade/Class (e.g., 9, 10)">
                        </div>
                        <div id="facultyFieldsAdd" style="display: none;">
                            <input type="text" id="newUserDepartment" placeholder="Department">
                        </div>
                        <button type="submit" class="btn btn-primary" id="addUserBtn">â• Add Student</button>
                    </form>
                    <div class="user-message" id="userMessage" style="display: none;"></div>
                </div>
                
                <div class="user-list-section">
                    <h4>ğŸ“‹ <span id="userListTitle">Students</span> List</h4>
                    <div class="user-list" id="userList">
                        <!-- Users will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Activity Modal (Admin Only) -->
    <div class="modal" id="loginActivityModal" style="display: none;">
        <div class="modal-content login-activity-modal">
            <div class="modal-header">
                <h3>ğŸ” Login Activity</h3>
                <button class="modal-close" onclick="closeLoginActivityModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="login-activity-actions">
                    <button class="btn btn-secondary btn-sm" onclick="loadLoginActivity()">ğŸ”„ Refresh</button>
                    <button class="btn btn-danger btn-sm" onclick="clearLoginActivity()">ğŸ—‘ï¸ Clear All</button>
                </div>
                <div class="login-activity-body" id="loginActivityList">
                    <!-- Login activity entries will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Course Viewer Modal -->
    <div class="modal course-viewer-modal" id="courseViewerModal" style="display: none;">
        <div class="course-viewer-content">
            <div class="course-viewer-header">
                <h3 id="courseViewerTitle">Course Title</h3>
                <div class="course-progress-header">
                    <div class="progress-bar-header">
                        <div class="progress-fill-header" id="courseProgressBar" style="width: 0%"></div>
                    </div>
                    <span id="courseProgressText">0% Complete</span>
                </div>
                <button class="modal-close" onclick="IlmifyCourses.closeCourseViewer()">âœ•</button>
            </div>
            <div class="course-viewer-body">
                <div class="course-sidebar">
                    <h4>ğŸ“š Lessons</h4>
                    <div class="lessons-list" id="courseLessonsList">
                        <!-- Lessons will be loaded here -->
                    </div>
                </div>
                <div class="course-content" id="lessonContent">
                    <!-- Lesson content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Course Create/Edit Modal -->
    <div class="modal" id="courseCreateModal" style="display: none;">
        <div class="modal-content course-create-modal">
            <div class="modal-header">
                <h3 id="courseCreateTitle">â• Create New Course</h3>
                <button class="modal-close" onclick="IlmifyCourses.closeCourseCreateModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="courseForm" onsubmit="IlmifyCourses.saveCourse(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="courseTitleInput">Course Title *</label>
                            <input type="text" id="courseTitleInput" required placeholder="e.g., Introduction to Science">
                        </div>
                        <div class="form-group">
                            <label for="courseTitleUrduInput">Title (Urdu)</label>
                            <input type="text" id="courseTitleUrduInput" placeholder="e.g., Ø³Ø§Ø¦Ù†Ø³ Ú©Ø§ ØªØ¹Ø§Ø±Ù" dir="rtl">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="courseDescInput">Description</label>
                        <textarea id="courseDescInput" rows="2" placeholder="Brief description of the course..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="courseCategoryInput">Category</label>
                            <select id="courseCategoryInput">
                                <option value="">Select Category</option>
                                <option value="Science">ğŸ”¬ Science</option>
                                <option value="Math">ğŸ“ Mathematics</option>
                                <option value="English">ğŸ“ English</option>
                                <option value="Urdu">ğŸ“– Urdu</option>
                                <option value="Health">ğŸ¥ Health</option>
                                <option value="Islamic Studies">ğŸ•Œ Islamic Studies</option>
                                <option value="Pakistan Studies">ğŸ‡µğŸ‡° Pakistan Studies</option>
                                <option value="Computer">ğŸ’» Computer</option>
                                <option value="Other">ğŸ“š Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="courseInstructorInput">Instructor</label>
                            <input type="text" id="courseInstructorInput" placeholder="Your name">
                        </div>
                        <div class="form-group">
                            <label for="courseThumbnailInput">Emoji Icon</label>
                            <input type="text" id="courseThumbnailInput" placeholder="ğŸ“š" maxlength="2">
                        </div>
                    </div>
                    
                    <div id="lessonsEditorContainer">
                        <!-- Lessons editor will be loaded here -->
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="IlmifyCourses.closeCourseCreateModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">ğŸ’¾ Save Course</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Lesson Edit Modal -->
    <div class="modal" id="lessonEditModal" style="display: none;">
        <div class="modal-content lesson-edit-modal">
            <div class="modal-header">
                <h3 id="lessonEditTitle">â• Add Lesson</h3>
                <button class="modal-close" onclick="IlmifyCourses.closeLessonEditModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="lessonEditForm" onsubmit="event.preventDefault(); IlmifyCourses.saveLesson();">
                    <div class="form-group">
                        <label for="lessonTitleInput">Lesson Title *</label>
                        <input type="text" id="lessonTitleInput" required placeholder="e.g., Introduction">
                    </div>
                    
                    <div class="form-group">
                        <label for="lessonTypeInput">Content Type</label>
                        <select id="lessonTypeInput" onchange="IlmifyCourses.toggleLessonType(this.value)">
                            <option value="text">ğŸ“„ Text/Article</option>
                            <option value="video">ğŸ¬ Video</option>
                        </select>
                    </div>
                    
                    <div id="lessonTextFields">
                        <div class="form-group">
                            <label for="lessonContentInput">Content (HTML supported)</label>
                            <textarea id="lessonContentInput" rows="8" placeholder="Enter lesson content... You can use HTML tags like <h3>, <p>, <ul>, <li>, <strong>, <em>"></textarea>
                        </div>
                    </div>
                    
                    <div id="lessonVideoFields" style="display: none;">
                        <div class="form-group">
                            <label for="lessonVideoUrlInput">Video URL (from content folder)</label>
                            <input type="text" id="lessonVideoUrlInput" placeholder="e.g., content/videos/lesson1.mp4">
                            <small>Upload videos to the content/videos folder first, then enter the path here.</small>
                        </div>
                        <div class="form-group">
                            <label for="lessonContentInput2">Video Description (optional)</label>
                            <textarea id="lessonContentInput2" rows="3" placeholder="Additional notes for this video lesson..."></textarea>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="IlmifyCourses.closeLessonEditModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">ğŸ’¾ Save Lesson</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Chatbot Floating Action Button -->
    <button class="chatbot-fab" id="chatbotFab" onclick="toggleChatbot()" title="Ask Ilmify Assistant">
        <span class="fab-pulse"></span>
        ğŸ’¬
    </button>

    <!-- Chat Modal -->
    <div class="chat-modal" id="chatModal">
        <div class="chat-header">
            <div class="chat-header-avatar">ğŸ¤–</div>
            <div class="chat-header-info">
                <h4>Ilmify Assistant</h4>
                <span>Online - Ready to help</span>
            </div>
            <button class="chat-header-btn" onclick="clearChat()" title="Clear Chat">ğŸ—‘ï¸</button>
            <button class="chat-close" onclick="closeChatbot()">âœ•</button>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <!-- Messages will be added here dynamically -->
        </div>
        
        <div class="chat-quick-questions" id="quickQuestions">
            <div class="quick-questions-label">Quick Actions:</div>
            <div class="quick-questions-list">
                <button class="quick-question-btn" onclick="askQuickQuestion('Quiz me!')">ğŸ¯ Quiz</button>
                <button class="quick-question-btn" onclick="askQuickQuestion('Define knowledge')">ğŸ“– Dictionary</button>
                <button class="quick-question-btn" onclick="askQuickQuestion('Health tips')">ğŸ¥ Health</button>
                <button class="quick-question-btn" onclick="askQuickQuestion('Tell me a joke')">ğŸ˜„ Fun</button>
                <button class="quick-question-btn" onclick="askQuickQuestion('Motivate me')">ğŸ’ª Inspire</button>
                <button class="quick-question-btn" onclick="askQuickQuestion('help')">â“ Help</button>
            </div>
        </div>
        
        <div class="chat-input-area">
            <input 
                type="text" 
                class="chat-input" 
                id="chatInput" 
                placeholder="Ask me anything... (e.g., What is photosynthesis?)"
                onkeypress="handleChatKeypress(event)"
            >
            <button class="chat-send-btn" id="chatSendBtn" onclick="sendChatMessage()">
                â¤
            </button>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/main.js"></script>
    <script src="js/faculty.js"></script>
    <script src="js/courses.js"></script>
    <script src="js/quiz.js"></script>
    <script src="js/chatbot.js"></script>
    <script>
        // Initialize header navigation based on user role
        document.addEventListener('DOMContentLoaded', () => {
            const headerNav = document.getElementById('headerNav');
            const session = IlmifyAuth.getSession();
            
            if (!session) {
                headerNav.innerHTML = `
                    <a href="login.html" class="nav-btn login-btn">ğŸ” Login</a>
                `;
            } else {
                let navItems = `<span class="user-greeting">ğŸ‘‹ ${session.name}</span>`;
                
                // Faculty/Admin can upload
                if (session.role === 'faculty' || session.role === 'admin' || session.isAdmin) {
                    navItems += `<button class="nav-btn" onclick="openUploadModal()">ğŸ“¤ Upload</button>`;
                }
                
                // Admin only features
                if (session.isAdmin) {
                    navItems += `<button class="nav-btn" onclick="openUserModal()">ğŸ‘¥ Users</button>`;
                    navItems += `<button class="nav-btn" onclick="openLoginActivityModal()">ğŸ” Activity</button>`;
                }
                
                navItems += `<button class="nav-btn logout-btn" onclick="IlmifyAuth.logout()">ğŸšª Logout</button>`;
                
                headerNav.innerHTML = navItems;
            }
            
            // Setup file upload handlers
            if (typeof setupFileUpload === 'function') {
                setupFileUpload();
            }
        });
    </script>
</body>
</html>
