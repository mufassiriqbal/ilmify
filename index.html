<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ilmify - Offline Knowledge Server for Rural Schools">
    <title>Ilmify - Education That Reaches You</title>
    <link rel="stylesheet" href="portal/css/style.css">
    <link rel="stylesheet" href="portal/css/auth.css">
    <script src="portal/js/auth.js"></script>
    <script>
        // Check login before page loads
        document.addEventListener('DOMContentLoaded', function() {
            if (!window.IlmifyAuth || !window.IlmifyAuth.isLoggedIn()) {
                window.location.href = 'portal/login.html';
            }
        });
    </script>
</head>
<body>
    <header class="header">
        <div class="container header-content">
            <div class="logo">
                <span class="logo-icon">üìö</span>
                <h1>Ilmify</h1>
                <p class="tagline">Education That Reaches You</p>
            </div>
            <!-- Notification Bell & User Menu -->
            <div class="header-actions">
                <div class="notification-bell-wrapper">
                    <div class="notification-bell" id="notificationBell" onclick="toggleNotificationPanel()">
                        <span class="bell-icon">üîî</span>
                        <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                        <span class="notification-dot" id="notificationDot" style="display: none;"></span>
                    </div>
                    <!-- Notification Panel (Dropdown) -->
                    <div class="notification-panel" id="notificationPanel" style="display: none;">
                        <div class="notification-panel-arrow"></div>
                        <div class="notification-panel-header">
                            <h3>üîî Notifications</h3>
                            <div class="notification-header-actions">
                                <button onclick="clearAllNotifications()" class="clear-all-btn">Clear All</button>
                                <button onclick="closeNotificationPanel()" class="modal-close notification-close-btn">‚úï</button>
                            </div>
                        </div>
                        <div class="notification-panel-body" id="notificationPanelBody">
                            <p class="no-notifications">No notifications yet</p>
                        </div>
                    </div>
                </div>
                <div class="user-menu" id="userMenu">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <!-- Faculty Control Panel (Only visible to faculty/admin) -->
            <section class="faculty-panel" id="facultyPanel" style="display: none;">
                <div class="faculty-buttons">
                    <button class="upload-btn" onclick="openUploadModal()">
                        ‚ûï Add Resource
                    </button>
                    <button class="manage-btn" id="manageUsersBtn" onclick="openUserModal()" style="display: none;">
                        üë• Manage Users
                    </button>
                    <button class="notify-btn" id="notifyUsersBtn" onclick="openNotificationModal()" style="display: none;">
                        üì¢ Send Notification
                    </button>
                </div>
                <!-- Admin Stats Panel (Only visible to admin) -->
                <div class="admin-stats-panel" id="adminStatsPanel" style="display: none;">
                    <div class="stats-card">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-info">
                            <span class="stat-value" id="activeUsersCount">0</span>
                            <span class="stat-label">Active Users</span>
                        </div>
                    </div>
                    <div class="stats-card">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-info">
                            <span class="stat-value" id="totalSessionsCount">0</span>
                            <span class="stat-label">Total Sessions</span>
                        </div>
                    </div>
                    <button class="refresh-stats-btn" onclick="refreshUserStats()" title="Refresh Stats">
                        üîÑ
                    </button>
                </div>
            </section>

            <!-- Search Section -->
            <section class="search-section">
                <div class="search-box">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="Search resources... / ÿ™ŸÑÿßÿ¥ ⁄©ÿ±€å⁄∫..."
                        aria-label="Search resources"
                    >
                    <button id="searchBtn" class="search-btn" aria-label="Search">
                        üîç
                    </button>
                </div>
            </section>

            <!-- Categories Section -->
            <section class="categories-section">
                <h2 class="section-title">Browse by Category</h2>
                <div class="categories-grid">
                    <button class="category-card" data-category="textbooks">
                        <div class="category-icon">üìñ</div>
                        <h3>School Textbooks</h3>
                        <p>ŸÜÿµÿßÿ®€å ⁄©ÿ™ÿßÿ®€å⁄∫</p>
                        <span class="resource-count" id="textbooks-count">0 resources</span>
                    </button>

                    <button class="category-card" data-category="videos">
                        <div class="category-icon">üé¨</div>
                        <h3>Video Lectures</h3>
                        <p>Ÿà€å⁄à€åŸà ŸÑ€å⁄©⁄Üÿ±ÿ≤</p>
                        <span class="resource-count" id="videos-count">0 resources</span>
                    </button>

                    <button class="category-card" data-category="health-guides">
                        <div class="category-icon">üè•</div>
                        <h3>Health Guides</h3>
                        <p>ÿµÿ≠ÿ™ ⁄©€í ÿ±€ÅŸÜŸÖÿß</p>
                        <span class="resource-count" id="health-guides-count">0 resources</span>
                    </button>

                    <button class="category-card dictionary-card" onclick="openDictionary()">
                        <div class="category-icon">üìñ</div>
                        <h3>English Dictionary</h3>
                        <p>ÿßŸÜ⁄ØŸÑÿ¥ ŸÑÿ∫ÿ™</p>
                        <span class="resource-count">Learn words</span>
                    </button>

                    <button class="category-card courses-card" onclick="window.location.href='courses.html'">
                        <div class="category-icon">üéì</div>
                        <h3>Interactive Courses</h3>
                        <p>ÿßŸÜŸπÿ±ÿß€å⁄©ŸπŸà ⁄©Ÿàÿ±ÿ≥ÿ≤</p>
                        <span class="resource-count">Learn step by step</span>
                    </button>

                    <button class="category-card wikipedia-card coming-soon-card" onclick="showComingSoon('Wikipedia')">
                        <div class="category-icon">üåê</div>
                        <h3>Wikipedia</h3>
                        <p>Ÿà€å⁄©€åŸæ€å⁄à€åÿß</p>
                        <span class="resource-count coming-soon-badge">Coming Soon</span>
                    </button>

                    <button class="category-card gpt-card coming-soon-card" onclick="showComingSoon('AI Assistant')">
                        <div class="category-icon">ü§ñ</div>
                        <h3>Your GPT</h3>
                        <p>ÿß€í ÿ¢ÿ¶€å ÿßÿ≥ÿ≥ŸπŸÜŸπ</p>
                        <span class="resource-count coming-soon-badge">Coming Soon</span>
                    </button>
                </div>
            </section>

            <!-- Resources Section (Hidden initially) -->
            <section class="resources-section" id="resourcesSection" style="display: none;">
                <div class="resources-header">
                    <button class="back-btn" id="backBtn" onclick="hideResources()">
                        ‚Üê Back to Categories
                    </button>
                    <h2 class="section-title" id="resourcesTitle">All Resources</h2>
                </div>
                <div class="resources-grid" id="resourcesGrid">
                    <!-- Resources will be populated here -->
                </div>
                <div class="no-results" id="noResults" style="display: none;">
                    <span class="no-results-icon">üîç</span>
                    <p>No resources found</p>
                    <p>⁄©Ÿàÿ¶€å Ÿàÿ≥ÿßÿ¶ŸÑ ŸÜ€Å€å⁄∫ ŸÖŸÑ€í</p>
                </div>
            </section>

        </div>
    </main>

    <!-- Coming Soon Modal -->
    <div class="modal-overlay" id="comingSoonModal" style="display: none;">
        <div class="modal coming-soon-modal">
            <div class="modal-header coming-soon-header">
                <h2 id="comingSoonTitle">üöÄ Coming Soon</h2>
                <button class="modal-close" onclick="closeComingSoon()">‚úï</button>
            </div>
            <div class="modal-body coming-soon-body">
                <div class="coming-soon-content">
                    <div class="coming-soon-icon" id="comingSoonIcon">üåê</div>
                    <h3 id="comingSoonFeature">Wikipedia</h3>
                    <p>This feature is currently under development and will be available soon!</p>
                    <p class="urdu-text">€å€Å ŸÅ€å⁄Üÿ± ÿßÿ®⁄æ€å ⁄àŸà€åŸÑŸæŸÖŸÜŸπ ŸÖ€å⁄∫ €Å€í ÿßŸàÿ± ÿ¨ŸÑÿØ ÿØÿ≥ÿ™€åÿßÿ® €ÅŸà⁄Øÿß!</p>
                    <div class="coming-soon-features">
                        <h4>What to expect:</h4>
                        <ul id="comingSoonFeaturesList">
                            <li>üìö Access offline Wikipedia articles</li>
                            <li>üîç Search millions of topics</li>
                            <li>üåç Educational content in multiple languages</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Modal (Faculty Only) -->
    <div class="modal-overlay" id="uploadModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h2>üì§ Add New Resource</h2>
                <button class="modal-close" onclick="closeUploadModal()">‚úï</button>
            </div>
            <form id="uploadForm" class="upload-form">
                <div class="form-group">
                    <label for="resourceTitle">Resource Title *</label>
                    <input 
                        type="text" 
                        id="resourceTitle" 
                        name="title" 
                        placeholder="e.g., 9th Grade Mathematics"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="resourceCategory">Category *</label>
                    <select id="resourceCategory" name="category" required>
                        <option value="">Select category</option>
                        <option value="textbooks">üìñ School Textbooks</option>
                        <option value="videos">üé¨ Video Lectures</option>
                        <option value="health-guides">üè• Health Guides</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="resourceFile">Upload File *</label>
                    <div class="file-upload-area" id="fileUploadArea">
                        <input 
                            type="file" 
                            id="resourceFile" 
                            name="file" 
                            accept=".pdf,.mp4,.webm,.mkv"
                            required
                            hidden
                        >
                        <div class="file-upload-content" id="fileUploadContent">
                            <span class="file-icon">üìÅ</span>
                            <p>Click to select or drag & drop</p>
                            <p class="file-hint">PDF, MP4, WebM (Max 500MB)</p>
                        </div>
                        <div class="file-selected" id="fileSelected" style="display: none;">
                            <span class="file-icon">‚úÖ</span>
                            <p id="selectedFileName">filename.pdf</p>
                            <button type="button" class="remove-file" onclick="removeSelectedFile()">‚úï</button>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="resourceDescription">Description (Optional)</label>
                    <textarea 
                        id="resourceDescription" 
                        name="description" 
                        rows="3"
                        placeholder="Brief description of the resource..."
                    ></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeUploadModal()">Cancel</button>
                    <button type="submit" class="btn-primary">
                        <span id="uploadBtnText">Upload Resource</span>
                        <span id="uploadSpinner" style="display: none;">Uploading...</span>
                    </button>
                </div>

                <!-- Upload Progress Bar -->
                <div class="upload-progress" id="uploadProgress" style="display: none;">
                    <div class="progress-label">Uploading...</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div class="progress-text" id="progressText">0%</div>
                </div>

                <div class="upload-error" id="uploadError" style="display: none;">
                    <span>‚ö†Ô∏è</span>
                    <p id="uploadErrorMsg">Error uploading file</p>
                </div>

                <div class="upload-success" id="uploadSuccess" style="display: none;">
                    <span>‚úÖ</span>
                    <p>Resource uploaded successfully!</p>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal (Faculty Only) -->
    <div class="modal-overlay" id="deleteModal" style="display: none;">
        <div class="modal modal-small">
            <div class="modal-header">
                <h2>üóëÔ∏è Delete Resource</h2>
                <button class="modal-close" onclick="closeDeleteModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this resource?</p>
                <p class="delete-resource-name" id="deleteResourceName"></p>
                <p class="warning-text">This action cannot be undone.</p>
            </div>
            <div class="form-actions">
                <button type="button" class="btn-secondary" onclick="closeDeleteModal()">Cancel</button>
                <button type="button" class="btn-danger" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>

    <!-- User Management Modal (Admin Only) -->
    <div class="modal-overlay" id="userModal" style="display: none;">
        <div class="modal modal-large">
            <div class="modal-header">
                <h2>üë• Manage Users</h2>
                <button class="modal-close" onclick="closeUserModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <!-- User Type Tabs -->
                <div class="user-type-tabs">
                    <button class="user-tab active" data-type="student" onclick="switchUserTab('student')">üéì Students</button>
                    <button class="user-tab" data-type="faculty" onclick="switchUserTab('faculty')">üë®‚Äçüè´ Faculty</button>
                </div>

                <!-- Add User Form -->
                <div class="add-user-section">
                    <h3 id="addUserTitle">‚ûï Add New Student</h3>
                    <form id="addUserForm" class="add-user-form">
                        <input type="hidden" id="newUserType" value="student">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="newUserFirstName">First Name *</label>
                                <input type="text" id="newUserFirstName" required>
                            </div>
                            <div class="form-group">
                                <label for="newUserLastName">Last Name *</label>
                                <input type="text" id="newUserLastName" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="newUserEmail">Email *</label>
                                <input type="email" id="newUserEmail" required>
                            </div>
                            <div class="form-group" id="gradeField">
                                <label for="newUserGrade">Class/Grade</label>
                                <select id="newUserGrade">
                                    <option value="">Select</option>
                                    <option value="6">Class 6</option>
                                    <option value="7">Class 7</option>
                                    <option value="8">Class 8</option>
                                    <option value="9">Class 9</option>
                                    <option value="10">Class 10</option>
                                    <option value="11">Class 11</option>
                                    <option value="12">Class 12</option>
                                </select>
                            </div>
                            <div class="form-group" id="departmentField" style="display: none;">
                                <label for="newUserDepartment">Department</label>
                                <select id="newUserDepartment">
                                    <option value="">Select</option>
                                    <option value="Science">Science</option>
                                    <option value="Mathematics">Mathematics</option>
                                    <option value="English">English</option>
                                    <option value="Urdu">Urdu</option>
                                    <option value="Social Studies">Social Studies</option>
                                    <option value="Computer">Computer</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="newUserPassword">Password *</label>
                            <input type="password" id="newUserPassword" required minlength="6" placeholder="Minimum 6 characters">
                        </div>
                        <button type="submit" class="btn-primary" id="addUserBtn">Add Student</button>
                    </form>
                    <div class="add-user-message" id="addUserMessage" style="display: none;"></div>
                </div>

                <!-- User List -->
                <div class="user-list-section">
                    <h3 id="userListTitle">üìã Registered Students</h3>
                    <div class="user-list" id="userList">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>Ilmify - Education That Reaches You</p>
            <p class="footer-urdu">ÿ™ÿπŸÑ€åŸÖ ÿ¨Ÿà ÿ¢Ÿæ ÿ™⁄© Ÿæ€ÅŸÜ⁄Ü€í</p>
        </div>
    </footer>

    <!-- Chatbot Floating Button -->
    <button class="chatbot-fab" onclick="openChatbot()" title="Ask Study Assistant">
        <span class="fab-icon">üí¨</span>
        <span class="fab-pulse"></span>
    </button>

    <!-- Chatbot Modal -->
    <div id="chatModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 9999; justify-content: center; align-items: center;">
        <div style="background: white; border-radius: 16px; width: 90%; max-width: 400px; max-height: 80vh; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
            <!-- Header -->
            <div style="background: #0A1F44; color: white; padding: 16px; display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 24px;">ü§ñ</span>
                    <div>
                        <h3 style="margin: 0; font-size: 16px;">Ilmify Assistant</h3>
                        <span style="font-size: 12px; opacity: 0.8;">Online ‚Ä¢ Ready to help</span>
                    </div>
                </div>
                <button onclick="closeChatbot()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">‚úï</button>
            </div>
            
            <!-- Messages -->
            <div id="chatMessages" style="flex: 1; padding: 16px; overflow-y: auto; min-height: 200px; background: #f5f5f5;">
                <!-- Messages will be added here -->
            </div>
            
            <!-- Quick Questions -->
            <div style="padding: 8px 16px; display: flex; gap: 8px; flex-wrap: wrap; border-top: 1px solid #ddd;">
                <button onclick="askQuickQuestion('Show me textbooks')" style="padding: 6px 12px; border: 1px solid #0A1F44; background: white; border-radius: 20px; cursor: pointer; font-size: 12px;">üìö Textbooks</button>
                <button onclick="askQuickQuestion('Show me videos')" style="padding: 6px 12px; border: 1px solid #0A1F44; background: white; border-radius: 20px; cursor: pointer; font-size: 12px;">üé¨ Videos</button>
                <button onclick="askQuickQuestion('What resources?')" style="padding: 6px 12px; border: 1px solid #0A1F44; background: white; border-radius: 20px; cursor: pointer; font-size: 12px;">üìã Resources</button>
            </div>
            
            <!-- Input Area -->
            <div style="padding: 12px 16px; border-top: 1px solid #ddd; display: flex; gap: 8px;">
                <input type="text" id="chatInput" placeholder="Type your question..." style="flex: 1; padding: 10px 14px; border: 1px solid #ddd; border-radius: 24px; outline: none; font-size: 14px;">
                <button id="chatSendBtn" onclick="sendMessage()" style="width: 44px; height: 44px; border-radius: 50%; background: #F7B500; border: none; cursor: pointer; font-size: 18px;">‚û§</button>
            </div>
        </div>
    </div>

    <!-- Admin Notification Modal -->
    <div class="modal-overlay" id="notificationModal" style="display: none;">
        <div class="modal notification-modal">
            <div class="modal-header notification-modal-header">
                <h2>üì¢ Send Notification to All Users</h2>
                <button class="modal-close" onclick="closeNotificationModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="notificationForm" onsubmit="sendNotification(event)">
                    <div class="form-group">
                        <label for="notificationTitle">Notification Title *</label>
                        <input type="text" id="notificationTitle" placeholder="e.g., New Course Available!" required maxlength="50">
                    </div>
                    <div class="form-group">
                        <label for="notificationMessage">Message *</label>
                        <textarea id="notificationMessage" rows="3" placeholder="Enter your message..." required maxlength="200"></textarea>
                        <small id="notificationCharCount">0/200 characters</small>
                    </div>
                    <div class="form-group">
                        <label for="notificationType">Notification Type</label>
                        <select id="notificationType">
                            <option value="info">‚ÑπÔ∏è Information</option>
                            <option value="success">‚úÖ Success / Good News</option>
                            <option value="warning">‚ö†Ô∏è Warning / Alert</option>
                            <option value="announcement">üì£ Announcement</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="notificationDuration">Display Duration</label>
                        <select id="notificationDuration">
                            <option value="3000">3 seconds</option>
                            <option value="5000" selected>5 seconds</option>
                            <option value="7000">7 seconds</option>
                            <option value="10000">10 seconds</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="closeNotificationModal()">Cancel</button>
                        <button type="submit" class="btn-primary">üì¢ Send to All Users</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Global Notification Popup -->
    <div class="global-notification-container" id="globalNotificationContainer"></div>

    <!-- Toast Notification -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Fullscreen Course Viewer -->
    <div class="course-fullscreen" id="courseViewerModal" style="display: none;">
        <div class="course-fullscreen-header">
            <button class="course-back-btn" onclick="IlmifyCourses.closeCourseViewer()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                Back to Courses
            </button>
            <h1 id="courseViewerTitle">Course Title</h1>
            <div class="course-progress-header">
                <span id="courseProgressText">0%</span>
                <div class="progress-bar-header">
                    <div class="progress-fill-header" id="courseProgressBar"></div>
                </div>
            </div>
        </div>
        
        <div class="course-fullscreen-body">
            <!-- Lesson Content Area -->
            <div class="lesson-content-fullscreen" id="lessonContent">
                <!-- Lesson content will be rendered here -->
            </div>
        </div>

        <!-- Fixed Bottom Navigation -->
        <div class="course-fullscreen-nav">
            <button class="nav-btn nav-prev" id="prevLessonBtn" onclick="IlmifyCourses.previousLesson()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M15 18l-6-6 6-6"/>
                </svg>
                Previous
            </button>
            <button class="nav-btn nav-complete" id="completeLessonBtn" onclick="IlmifyCourses.markComplete()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 6L9 17l-5-5"/>
                </svg>
                <span id="completeBtnText">Complete</span>
            </button>
            <button class="nav-btn nav-next" id="nextLessonBtn" onclick="IlmifyCourses.nextLesson()">
                Next
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 18l6-6-6-6"/>
                </svg>
            </button>
        </div>

        <!-- Lessons Sidebar (toggleable) -->
        <div class="lessons-sidebar" id="lessonsSidebar">
            <div class="sidebar-header">
                <h3>üìö Lessons</h3>
                <button class="sidebar-close" onclick="IlmifyCourses.toggleSidebar()">‚úï</button>
            </div>
            <div class="lessons-list" id="courseLessonsList">
                <!-- Lessons will be listed here -->
            </div>
        </div>
        
        <!-- Toggle Sidebar Button -->
        <button class="toggle-sidebar-btn" onclick="IlmifyCourses.toggleSidebar()" title="Show Lessons">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 12h18M3 6h18M3 18h18"/>
            </svg>
        </button>
    </div>

    <!-- Course Create/Edit Modal -->
    <div class="modal-overlay" id="courseCreateModal" style="display: none;">
        <div class="modal modal-large">
            <div class="modal-header">
                <h2 id="courseModalTitle">‚ûï Create New Course</h2>
                <button class="modal-close" onclick="IlmifyCourses.closeCourseCreateModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="courseForm" onsubmit="IlmifyCourses.saveCourse(event)">
                    <input type="hidden" id="courseId">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="courseTitle">Course Title *</label>
                            <input type="text" id="courseTitle" required placeholder="e.g., Introduction to Physics">
                        </div>
                        <div class="form-group">
                            <label for="courseCategory">Category</label>
                            <select id="courseCategory">
                                <option value="Science">Science</option>
                                <option value="Mathematics">Mathematics</option>
                                <option value="English">English</option>
                                <option value="Urdu">Urdu</option>
                                <option value="Social Studies">Social Studies</option>
                                <option value="Islamic Studies">Islamic Studies</option>
                                <option value="Computer">Computer</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="courseDescription">Description</label>
                        <textarea id="courseDescription" rows="3" placeholder="Brief description of the course..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="courseThumbnail">Thumbnail Emoji</label>
                        <input type="text" id="courseThumbnail" placeholder="e.g., üî¨ üìê üìñ" maxlength="2" value="üìö">
                    </div>
                    
                    <!-- Lessons Section -->
                    <div class="lessons-editor">
                        <div class="lessons-header">
                            <h3>üìã Lessons</h3>
                            <button type="button" class="btn btn-secondary" onclick="IlmifyCourses.addLessonModal()">‚ûï Add Lesson</button>
                        </div>
                        <div id="lessonsListEditor" class="lessons-list-editor">
                            <!-- Lessons will be listed here -->
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="IlmifyCourses.closeCourseCreateModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="saveCourseBtn">Create Course</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Lesson Edit Modal -->
    <div class="modal-overlay" id="lessonEditModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h2 id="lessonModalTitle">‚ûï Add Lesson</h2>
                <button class="modal-close" onclick="IlmifyCourses.closeLessonEditModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="lessonEditForm" onsubmit="event.preventDefault(); IlmifyCourses.saveLesson();">
                    <input type="hidden" id="lessonId">
                    <div class="form-group">
                        <label for="lessonTitle">Lesson Title *</label>
                        <input type="text" id="lessonTitle" required placeholder="e.g., Chapter 1: Introduction">
                    </div>
                    <div class="form-group">
                        <label for="lessonTypeInput">Content Type *</label>
                        <select id="lessonTypeInput" onchange="IlmifyCourses.toggleLessonType(this.value)">
                            <option value="text">üìù Text Content</option>
                            <option value="video">üé¨ Video (URL)</option>
                        </select>
                    </div>
                    <div class="form-group" id="lessonTextGroup">
                        <label for="lessonContentInput">Content</label>
                        <textarea id="lessonContentInput" rows="6" placeholder="Enter lesson content here... HTML is supported."></textarea>
                    </div>
                    <div class="form-group" id="lessonVideoGroup" style="display: none;">
                        <label for="lessonVideoUrl">Video URL</label>
                        <input type="url" id="lessonVideoUrl" placeholder="https://www.youtube.com/embed/...">
                        <small>Use YouTube embed URL or direct video URL</small>
                    </div>
                    <div class="form-group">
                        <label for="lessonDuration">Duration (minutes)</label>
                        <input type="number" id="lessonDuration" min="1" value="10" placeholder="10">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="IlmifyCourses.closeLessonEditModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Lesson</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="portal/js/main.js"></script>
    <script src="portal/js/faculty.js"></script>
    <script src="portal/js/chatbot.js"></script>
    <script>
        // Initialize user menu and faculty features
        document.addEventListener('DOMContentLoaded', () => {
            // Redirect if not logged in
            if (!window.IlmifyAuth || !window.IlmifyAuth.isLoggedIn()) {
                window.location.href = 'portal/login.html';
                return;
            }
            updateUserMenu();
            initFacultyFeatures();
        });

        function updateUserMenu() {
            const userMenu = document.getElementById('userMenu');
            const session = IlmifyAuth.getSession();

            if (session) {
                const isAdmin = session.isAdmin;
                const roleIcon = isAdmin ? 'üëë' : (session.role === 'faculty' ? 'üë®‚Äçüè´' : 'üéì');
                const roleLabel = isAdmin ? 'Admin' : session.role;
                const roleBadge = isAdmin ? '<span class="admin-badge">Admin</span>' : 
                                  (session.role === 'faculty' ? '<span class="faculty-badge">Faculty</span>' : '');
                
                userMenu.innerHTML = `
                    <div class="user-info">
                        <div class="user-avatar">${roleIcon}</div>
                        <div>
                            <div class="user-name">${session.name} ${roleBadge}</div>
                            <div class="user-role">${roleLabel}</div>
                        </div>
                    </div>
                    <button class="logout-btn" onclick="handleLogout()">Logout</button>
                `;
            } else {
                window.location.href = 'portal/login.html';
            }
        }

        function initFacultyFeatures() {
            const session = IlmifyAuth.getSession();
            const facultyPanel = document.getElementById('facultyPanel');
            const manageUsersBtn = document.getElementById('manageUsersBtn');
            const notifyUsersBtn = document.getElementById('notifyUsersBtn');
            const createCourseBtn = document.getElementById('createCourseBtn');
            
            // Show faculty panel for admin and faculty
            if (session && (session.isAdmin || session.role === 'faculty' || session.role === 'admin')) {
                facultyPanel.style.display = 'block';
                
                // Show create course button for faculty and admin
                if (createCourseBtn) {
                    createCourseBtn.style.display = 'inline-flex';
                }
                
                // Only show manage users and notify buttons for admin
                if (manageUsersBtn) {
                    manageUsersBtn.style.display = session.isAdmin ? 'flex' : 'none';
                }
                if (notifyUsersBtn) {
                    notifyUsersBtn.style.display = session.isAdmin ? 'flex' : 'none';
                }
                
                // Show admin stats panel only for admin
                const adminStatsPanel = document.getElementById('adminStatsPanel');
                if (adminStatsPanel) {
                    if (session.isAdmin) {
                        adminStatsPanel.style.display = 'flex';
                        initAdminStats();
                    } else {
                        adminStatsPanel.style.display = 'none';
                    }
                }
            } else {
                facultyPanel.style.display = 'none';
                if (createCourseBtn) {
                    createCourseBtn.style.display = 'none';
                }
            }
            
            // Start checking for notifications (disabled for performance)
            checkForNotifications();
            // setInterval(checkForNotifications, 10000); // Disabled - use manual refresh
        }

        // ==================== Notification System ====================
        const NOTIFICATION_KEY = 'ilmify_global_notifications';
        const NOTIFICATION_SEEN_KEY = 'ilmify_notifications_seen';
        let notificationCheckInterval = null;

        function openNotificationModal() {
            document.getElementById('notificationModal').style.display = 'flex';
            document.getElementById('notificationTitle').value = '';
            document.getElementById('notificationMessage').value = '';
            document.getElementById('notificationCharCount').textContent = '0/200 characters';
            
            // Add character counter
            document.getElementById('notificationMessage').addEventListener('input', function() {
                document.getElementById('notificationCharCount').textContent = this.value.length + '/200 characters';
            });
        }

        function closeNotificationModal() {
            document.getElementById('notificationModal').style.display = 'none';
        }

        function sendNotification(event) {
            event.preventDefault();
            
            const title = document.getElementById('notificationTitle').value.trim();
            const message = document.getElementById('notificationMessage').value.trim();
            const type = document.getElementById('notificationType').value;
            const duration = parseInt(document.getElementById('notificationDuration').value);
            
            if (!title || !message) {
                showToast('Please fill in all fields', 'error');
                return;
            }

            const notification = {
                id: Date.now(),
                title,
                message,
                type,
                duration,
                timestamp: Date.now(),
                sentBy: IlmifyAuth.getSession()?.name || 'Admin'
            };

            // Store notification in localStorage for all users
            const notifications = JSON.parse(localStorage.getItem(NOTIFICATION_KEY) || '[]');
            notifications.push(notification);
            // Keep only last 20 notifications
            while (notifications.length > 20) {
                notifications.shift();
            }
            localStorage.setItem(NOTIFICATION_KEY, JSON.stringify(notifications));

            closeNotificationModal();
            showToast('Notification sent to all users!', 'success');
            
            // Show the notification immediately for the sender too
            displayGlobalNotification(notification);
            addToNotificationPanel(notification);
            updateNotificationBadge();
        }

        // Listen for localStorage changes (real-time sync between tabs/windows)
        window.addEventListener('storage', function(e) {
            if (e.key === NOTIFICATION_KEY) {
                const notifications = JSON.parse(e.newValue || '[]');
                const seenIds = JSON.parse(localStorage.getItem(NOTIFICATION_SEEN_KEY) || '[]');
                
                // Find new notifications
                notifications.forEach(notification => {
                    if (!seenIds.includes(notification.id)) {
                        displayGlobalNotification(notification);
                        addToNotificationPanel(notification);
                    }
                });
                updateNotificationBadge();
            }
        });

        function checkForNotifications() {
            const notifications = JSON.parse(localStorage.getItem(NOTIFICATION_KEY) || '[]');
            const seenIds = JSON.parse(localStorage.getItem(NOTIFICATION_SEEN_KEY) || '[]');
            
            let newCount = 0;
            notifications.forEach(notification => {
                if (!seenIds.includes(notification.id)) {
                    // Only show popup for notifications less than 30 seconds old
                    if (Date.now() - notification.timestamp < 30000) {
                        displayGlobalNotification(notification);
                    }
                    addToNotificationPanel(notification);
                    newCount++;
                }
            });
            
            updateNotificationBadge();
        }

        function displayGlobalNotification(notification) {
            const container = document.getElementById('globalNotificationContainer');
            if (!container) return;

            // Check if already displayed
            if (container.querySelector(`[data-notif-id="${notification.id}"]`)) return;

            const typeIcons = {
                'info': '‚ÑπÔ∏è',
                'success': '‚úÖ',
                'warning': '‚ö†Ô∏è',
                'announcement': 'üì£'
            };

            const notifEl = document.createElement('div');
            notifEl.className = `global-notification notification-${notification.type}`;
            notifEl.setAttribute('data-notif-id', notification.id);
            notifEl.innerHTML = `
                <div class="notification-icon">${typeIcons[notification.type] || 'üì¢'}</div>
                <div class="notification-content">
                    <h4>${notification.title}</h4>
                    <p>${notification.message}</p>
                    <span class="notification-sender">From: ${notification.sentBy}</span>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">‚úï</button>
            `;

            container.appendChild(notifEl);

            // Animate in
            setTimeout(() => notifEl.classList.add('show'), 10);

            // Mark as seen
            markNotificationSeen(notification.id);

            // Auto-remove after duration
            setTimeout(() => {
                notifEl.classList.remove('show');
                setTimeout(() => notifEl.remove(), 300);
            }, notification.duration || 5000);
        }

        // Notification Panel Functions
        function toggleNotificationPanel() {
            const panel = document.getElementById('notificationPanel');
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
                loadNotificationPanel();
                // Mark all as read when opening
                markAllNotificationsRead();
            } else {
                panel.style.display = 'none';
            }
        }

        function closeNotificationPanel() {
            document.getElementById('notificationPanel').style.display = 'none';
        }

        function loadNotificationPanel() {
            const body = document.getElementById('notificationPanelBody');
            const notifications = JSON.parse(localStorage.getItem(NOTIFICATION_KEY) || '[]');
            
            if (notifications.length === 0) {
                body.innerHTML = '<p class="no-notifications">No notifications yet</p>';
                return;
            }

            // Sort by timestamp descending (newest first)
            notifications.sort((a, b) => b.timestamp - a.timestamp);

            const typeIcons = {
                'info': '‚ÑπÔ∏è',
                'success': '‚úÖ',
                'warning': '‚ö†Ô∏è',
                'announcement': 'üì£'
            };

            let html = '';
            notifications.forEach(notification => {
                const timeAgo = getTimeAgo(notification.timestamp);
                html += `
                    <div class="notification-panel-item notification-${notification.type}">
                        <span class="panel-notif-icon">${typeIcons[notification.type] || 'üì¢'}</span>
                        <div class="panel-notif-content">
                            <strong>${notification.title}</strong>
                            <p>${notification.message}</p>
                            <small>${timeAgo} ‚Ä¢ From ${notification.sentBy}</small>
                        </div>
                    </div>
                `;
            });
            body.innerHTML = html;
        }

        function addToNotificationPanel(notification) {
            // This adds to the panel if it's open
            const body = document.getElementById('notificationPanelBody');
            if (!body) return;
            
            // Remove "no notifications" message if present
            const noNotif = body.querySelector('.no-notifications');
            if (noNotif) noNotif.remove();
        }

        function getTimeAgo(timestamp) {
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return Math.floor(seconds / 60) + 'm ago';
            if (seconds < 86400) return Math.floor(seconds / 3600) + 'h ago';
            return Math.floor(seconds / 86400) + 'd ago';
        }

        function markNotificationSeen(id) {
            const seenIds = JSON.parse(localStorage.getItem(NOTIFICATION_SEEN_KEY) || '[]');
            if (!seenIds.includes(id)) {
                seenIds.push(id);
                localStorage.setItem(NOTIFICATION_SEEN_KEY, JSON.stringify(seenIds));
            }
            updateNotificationBadge();
        }

        function markAllNotificationsRead() {
            const notifications = JSON.parse(localStorage.getItem(NOTIFICATION_KEY) || '[]');
            const seenIds = notifications.map(n => n.id);
            localStorage.setItem(NOTIFICATION_SEEN_KEY, JSON.stringify(seenIds));
            updateNotificationBadge();
        }

        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            const bell = document.getElementById('notificationBell');
            const dot = document.getElementById('notificationDot');
            if (!badge || !bell) return;
            
            const notifications = JSON.parse(localStorage.getItem(NOTIFICATION_KEY) || '[]');
            const seenIds = JSON.parse(localStorage.getItem(NOTIFICATION_SEEN_KEY) || '[]');
            
            const unreadCount = notifications.filter(n => !seenIds.includes(n.id)).length;
            
            if (unreadCount > 0) {
                badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
                badge.style.display = 'flex';
                if (dot) dot.style.display = 'block';
                bell.classList.add('has-notifications');
            } else {
                badge.style.display = 'none';
                if (dot) dot.style.display = 'none';
                bell.classList.remove('has-notifications');
            }
        }

        function clearAllNotifications() {
            localStorage.removeItem(NOTIFICATION_KEY);
            localStorage.removeItem(NOTIFICATION_SEEN_KEY);
            loadNotificationPanel();
            updateNotificationBadge();
            showToast('All notifications cleared', 'info');
        }

        // Close notification panel when clicking outside
        document.addEventListener('click', function(e) {
            const panel = document.getElementById('notificationPanel');
            const wrapper = document.querySelector('.notification-bell-wrapper');
            if (panel && panel.style.display === 'block' && 
                wrapper && !wrapper.contains(e.target)) {
                panel.style.display = 'none';
            }
        });

        // Close notification panel when scrolling
        window.addEventListener('scroll', function() {
            const panel = document.getElementById('notificationPanel');
            if (panel && panel.style.display === 'block') {
                panel.style.display = 'none';
            }
        });
        // ==================== End Notification System ====================

        // ==================== Admin User Stats ====================
        let sessionId = null;
        let heartbeatInterval = null;
        let statsRefreshInterval = null;

        // Register session with server and start heartbeat
        async function initUserSession() {
            const session = IlmifyAuth.getSession();
            if (!session) return;
            
            try {
                const response = await fetch('/api/heartbeat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: session.userId || session.email,
                        name: session.name,
                        role: session.role
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    sessionId = data.session_id;
                    
                    // Heartbeat disabled for performance
                    // if (heartbeatInterval) clearInterval(heartbeatInterval);
                    // heartbeatInterval = setInterval(sendHeartbeat, 30000);
                    
                    console.log('üì° Session registered:', sessionId);
                }
            } catch (err) {
                console.log('Heartbeat unavailable - running in basic mode');
            }
        }

        async function sendHeartbeat() {
            if (!sessionId) return;
            
            try {
                await fetch('/api/heartbeat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ session_id: sessionId })
                });
            } catch (err) {
                // Silently fail heartbeat
            }
        }

        // Admin stats initialization
        function initAdminStats() {
            refreshUserStats();
            
            // Stats refresh disabled for performance - use manual refresh button
            // if (statsRefreshInterval) clearInterval(statsRefreshInterval);
            // statsRefreshInterval = setInterval(refreshUserStats, 60000);
        }

        async function refreshUserStats() {
            try {
                const response = await fetch('/api/stats');
                if (!response.ok) throw new Error('Failed to fetch');
                
                const data = await response.json();
                
                const activeUsersEl = document.getElementById('activeUsersCount');
                const totalSessionsEl = document.getElementById('totalSessionsCount');
                
                if (activeUsersEl) {
                    activeUsersEl.textContent = data.active_users || 0;
                    activeUsersEl.classList.add('stat-updated');
                    setTimeout(() => activeUsersEl.classList.remove('stat-updated'), 500);
                }
                
                if (totalSessionsEl) {
                    totalSessionsEl.textContent = data.total_unique_users || data.total_requests || 0;
                    totalSessionsEl.classList.add('stat-updated');
                    setTimeout(() => totalSessionsEl.classList.remove('stat-updated'), 500);
                }
            } catch (err) {
                // Fallback: Show at least 1 active user (the current user)
                const activeUsersEl = document.getElementById('activeUsersCount');
                if (activeUsersEl && activeUsersEl.textContent === '0') {
                    activeUsersEl.textContent = '1';
                }
                console.log('Stats API unavailable - using fallback');
            }
        }

        // Initialize session tracking on page load
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(initUserSession, 1000); // Give auth time to load
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (heartbeatInterval) clearInterval(heartbeatInterval);
            if (statsRefreshInterval) clearInterval(statsRefreshInterval);
        });
        // ==================== End Admin User Stats ====================

        function handleLogout() {
            IlmifyAuth.logout();
        }

        // Toast notification helper
        function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            const icons = { success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è', warning: '‚ö†Ô∏è' };
            toast.innerHTML = `<span class="toast-icon">${icons[type] || icons.info}</span><span class="toast-message">${message}</span>`;
            
            container.appendChild(toast);
            
            // Trigger animation
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Remove after duration
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }
        
        window.showToast = showToast;
    </script>

    <!-- Dictionary Modal -->
    <div class="modal-overlay" id="dictionaryModal" style="display: none;">
        <div class="modal modal-large dict-modal">
            <div class="modal-header">
                <h2>üìñ English Dictionary</h2>
                <button class="modal-close" onclick="closeDictionary()">‚úï</button>
            </div>
            <div class="modal-body dict-body">
                <!-- Search Section -->
                <div class="dict-search-section">
                    <input type="text" id="dictSearchInput" class="dict-search-input" placeholder="Search for a word..." onkeypress="if(event.key==='Enter') searchDictionary()">
                    <button class="btn-primary" onclick="searchDictionary()">üîç Search</button>
                </div>

                <!-- Word of the Day -->
                <div class="dict-wotd" id="dictWOTD">
                    <!-- Will be populated by JS -->
                </div>

                <!-- Search Results -->
                <div class="dict-results" id="dictResults">
                    <div class="dict-welcome">
                        <h3>Welcome to Ilmify Dictionary! üìö</h3>
                        <p>Search for English words to see their definitions, examples, and Urdu translations.</p>
                        <p>Try searching: education, knowledge, science, or any other word!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="portal/js/dictionary.js"></script>
    <script>
        // Dictionary Functions
        async function openDictionary() {
            const modal = document.getElementById('dictionaryModal');
            modal.style.display = 'flex';
            modal.classList.add('modal-animate');
            document.body.style.overflow = 'hidden';

            const wotdContainer = document.getElementById('dictWOTD');
            if (window.IlmifyDictionary && wotdContainer) {
                wotdContainer.innerHTML = '<div class="dict-loading">Loading word of the day‚Ä¶</div>';
                try {
                    await window.IlmifyDictionary.ready();
                    const wotd = await window.IlmifyDictionary.getWordOfTheDay();
                    wotdContainer.innerHTML = `
                        <h4>üìÖ Word of the Day</h4>
                        ${window.IlmifyDictionary.formatEntry(wotd)}
                    `;
                } catch (error) {
                    wotdContainer.innerHTML = '<div class="dict-error">Unable to load word of the day. Please try again.</div>';
                    console.error('Word of the day load failed:', error);
                }
            }

            document.getElementById('dictSearchInput').focus();
        }

        function closeDictionary() {
            const modal = document.getElementById('dictionaryModal');
            modal.classList.remove('modal-animate');
            setTimeout(() => {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }, 200);
        }

        async function searchDictionary() {
            const input = document.getElementById('dictSearchInput');
            const query = input.value.trim();
            const resultsDiv = document.getElementById('dictResults');

            if (!query) {
                resultsDiv.innerHTML = `<div class="dict-no-results">
                    <span class="no-results-icon">‚ÑπÔ∏è</span>
                    <p>Please type a word to search.</p>
                    <p>Examples: education, knowledge, science.</p>
                </div>`;
                return;
            }

            if (resultsDiv) {
                resultsDiv.innerHTML = '<div class="dict-loading">Searching‚Ä¶</div>';
            }

            try {
                await window.IlmifyDictionary.ready();
                const results = await window.IlmifyDictionary.search(query);

                if (!results || results.length === 0) {
                    resultsDiv.innerHTML = `
                        <div class="dict-no-results">
                            <span class="no-results-icon">üîç</span>
                            <p>No results found for "${query}"</p>
                            <p>Try checking the spelling or search for another word.</p>
                        </div>
                    `;
                    return;
                }

                let html = `<h4>Search Results (${results.length})</h4>`;
                results.forEach(entry => {
                    html += window.IlmifyDictionary.formatEntry(entry);
                });

                resultsDiv.innerHTML = html;
            } catch (error) {
                console.error('Dictionary search failed:', error);
                resultsDiv.innerHTML = `
                    <div class="dict-error">
                        <p>‚ö†Ô∏è Unable to search the dictionary right now.</p>
                        <p>Please check your files or try again later.</p>
                    </div>
                `;
            }
        }
    </script>
    <script>
        // Coming Soon Modal Functions
        function showComingSoon(feature) {
            const modal = document.getElementById('comingSoonModal');
            const icon = document.getElementById('comingSoonIcon');
            const title = document.getElementById('comingSoonFeature');
            const featuresList = document.getElementById('comingSoonFeaturesList');
            
            if (feature === 'Wikipedia') {
                icon.textContent = 'üåê';
                title.textContent = 'Wikipedia';
                featuresList.innerHTML = `
                    <li>üìö Access offline Wikipedia articles</li>
                    <li>üîç Search millions of topics</li>
                    <li>üåç Educational content in multiple languages</li>
                    <li>üíæ Works without internet connection</li>
                `;
            } else if (feature === 'AI Assistant') {
                icon.textContent = 'ü§ñ';
                title.textContent = 'AI Assistant';
                featuresList.innerHTML = `
                    <li>üí¨ Ask questions in natural language</li>
                    <li>üìñ Get help with homework</li>
                    <li>üß† Learn concepts explained simply</li>
                    <li>üîÆ Powered by offline AI technology</li>
                `;
            }
            
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        function closeComingSoon() {
            const modal = document.getElementById('comingSoonModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        // Resources Section Functions
        function hideResources() {
            document.getElementById('resourcesSection').style.display = 'none';
            document.querySelector('.categories-section').style.display = 'block';
        }
        
        // Override category card clicks to show resources section
        document.addEventListener('DOMContentLoaded', function() {
            const categoryCards = document.querySelectorAll('.category-card[data-category]');
            categoryCards.forEach(card => {
                card.addEventListener('click', function() {
                    const category = this.dataset.category;
                    if (category) {
                        showResourcesForCategory(category);
                    }
                });
            });
        });
        
        function showResourcesForCategory(category) {
            // Show resources section
            document.getElementById('resourcesSection').style.display = 'block';
            document.querySelector('.categories-section').style.display = 'none';
            
            // Filter and display resources
            const categoryTitles = {
                'textbooks': 'School Textbooks - ŸÜÿµÿßÿ®€å ⁄©ÿ™ÿßÿ®€å⁄∫',
                'videos': 'Video Lectures - Ÿà€å⁄à€åŸà ŸÑ€å⁄©⁄Üÿ±ÿ≤',
                'health-guides': 'Health Guides - ÿµÿ≠ÿ™ ⁄©€í ÿ±€ÅŸÜŸÖÿß'
            };
            
            document.getElementById('resourcesTitle').textContent = categoryTitles[category] || category;
            
            // Load and display resources
            loadAndDisplayResources(category);
        }
        
        async function loadAndDisplayResources(category) {
            const grid = document.getElementById('resourcesGrid');
            const noResults = document.getElementById('noResults');
            
            grid.innerHTML = '<div class="loading-resources">Loading resources...</div>';
            
            try {
                const response = await fetch('portal/data/metadata.json');
                const resources = await response.json();
                
                const filtered = resources.filter(r => r.category === category);
                
                // Check for deleted resources
                const deletedResources = JSON.parse(localStorage.getItem('ilmify_deleted_resources') || '[]');
                const available = filtered.filter(r => !deletedResources.includes(r.id));
                
                if (available.length === 0) {
                    grid.innerHTML = '';
                    noResults.style.display = 'block';
                    return;
                }
                
                noResults.style.display = 'none';
                grid.innerHTML = '';
                
                available.forEach(resource => {
                    const card = document.createElement('a');
                    card.className = 'resource-card';
                    card.href = resource.filepath;
                    card.target = '_blank';
                    
                    let icon = 'üìÑ';
                    if (resource.format === 'pdf') icon = 'üìï';
                    else if (resource.format === 'mp4' || resource.format === 'video') icon = 'üé•';
                    
                    card.innerHTML = `
                        <div class="resource-icon">${icon}</div>
                        <div class="resource-info">
                            <h3 class="resource-title">${resource.title}</h3>
                            <span class="resource-format">${resource.format.toUpperCase()}</span>
                        </div>
                    `;
                    
                    grid.appendChild(card);
                });
            } catch (error) {
                console.error('Error loading resources:', error);
                grid.innerHTML = '<div class="error-message">Unable to load resources</div>';
            }
        }
    </script>
    <script src="portal/js/main.js"></script>
    <script src="portal/js/faculty.js"></script>
    <script src="portal/js/chatbot.js"></script>
    <script src="portal/js/courses.js"></script>
</body>
</html>